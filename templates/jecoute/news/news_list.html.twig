{% extends 'jecoute/_layout.html.twig' %}

{% block javascripts %}
    <script type="text/javascript">
        Kernel.onLoad(function() {
            App.runManagedList(
                [
                    {
                        key: 'id',
                        name: 'ID',
                        style: {
                            width: 25,
                        }
                    },
                    {
                        key: 'title',
                        name: 'Titre',
                    },
                    {
                        key: 'text',
                        name: 'Texte',
                    },
                    {
                        key: 'zone',
                        name: 'Zone',
                        style: {
                            'minWidth': 200,
                        },
                    },
                    {
                        key: 'createdAt',
                        name: 'Date de création',
                    },
                    {
                        key: 'menu',
                        name: 'Action',
                        menu: true,
                    },
                ],
                [
                {%- spaceless %}
                    {% for data in news %}
                        {% set zone = data.zone %}
                        {% set row = {
                            id: data.id,
                            title: data.title,
                            text: data.text,
                            createdAt: data.createdAt|date('d/m/Y'),
                            zone: '<span class="adherent-dashboard-tag">'~('geo_zone.'~zone.type)|trans~'</span><br>'
                            ~"<div class=\"b__nudge--top-10\">#{zone.name} (#{zone.code})</span>",
                        } %}

                        {% set menu = [
                            {
                                label: 'Éditer',
                                url: path("app_jecoute_news_#{space_name}_news_edit", {uuid: data.uuid})
                            },
                            {
                                label: 'Supprimer',
                                url: path("app_jecoute_news_#{space_name}_news_delete", {uuid: data.uuid})
                            },
                        ] %}

                        {% set row = row|merge({
                            menu: menu
                        }) %}

                        {{ row|json_encode|raw }},
                    {% endfor %}
                {% endspaceless -%}
                ]
            );
        });
    </script>
{% endblock %}

{% block jecoute_content %}
    <div class="datagrid__table__tabs">
        <div class="datagrid__pre-table b__nudge--bottom-larger">
            <h3>Actualités</h3>
            <a href="{{ path("app_jecoute_news_#{space_name}_news_create") }}" class="btn-secondary btn-secondary--blue">
                + Créer une actualité
            </a>
        </div>
    </div>

    <div id="datagrid"></div>
{% endblock %}
